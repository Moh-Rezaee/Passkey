{"version":3,"file":"transaction.js","sources":["../../../src/shared/transaction.ts"],"sourcesContent":["import type { DBConnection, UsernamePolicy, PasswordPolicy, TransactionContext } from '../../interfaces/models/transaction';\nimport type { TransactionMembersOnLoginId } from '../../interfaces/screens/login-id';\nimport type { TransactionMembersOnSignupId } from '../../interfaces/screens/signup-id';\n\n/**\n * Checks if signup is enabled for the current connection.\n */\nexport function isSignupEnabled(transaction: TransactionContext): boolean {\n  return transaction?.connection?.options?.signup_enabled === true;\n}\n\n/**\n * Checks if forgot password is enabled.\n */\nexport function isForgotPasswordEnabled(transaction: TransactionContext): boolean {\n  const connection = transaction?.connection as DBConnection;\n  return connection?.options?.forgot_password_enabled === true;\n}\n\n/**\n * Checks if passkeys are enabled in the current connection.\n */\nexport function isPasskeyEnabled(transaction: TransactionContext): boolean {\n  const connection = transaction?.connection as DBConnection;\n  return connection?.options?.authentication_methods?.passkey?.enabled ?? false;\n}\n\n/**\n * Determines if a username is required for authentication.\n */\nexport function isUsernameRequired(transaction: TransactionContext): boolean {\n  const connection = transaction?.connection as DBConnection;\n  return connection?.options?.username_required ?? false;\n}\n\n/**\n * Retrieves the username policy from the transaction context.\n */\nexport function getUsernamePolicy(transaction: TransactionContext): UsernamePolicy | null {\n  const connection = transaction?.connection as DBConnection;\n  const validation = connection?.options?.attributes?.username?.validation;\n\n  if (!validation) return null;\n\n  return {\n    maxLength: validation.max_length,\n    minLength: validation.min_length,\n    allowedFormats: {\n      usernameInEmailFormat: validation.allowed_types?.email ?? false,\n      usernameInPhoneFormat: validation.allowed_types?.phone_number ?? false,\n    },\n  };\n}\n\n/**\n * Retrieves the password policy from the transaction context.\n */\nexport function getPasswordPolicy(transaction: TransactionContext): PasswordPolicy | null {\n  const connection = transaction?.connection as DBConnection;\n  const passwordPolicy = connection?.options?.authentication_methods?.password;\n\n  if (!passwordPolicy) return null;\n\n  return {\n    minLength: passwordPolicy.min_length,\n    policy: passwordPolicy.policy as PasswordPolicy['policy'],\n    passwordSecurityInfo: passwordPolicy.password_security_info,\n  };\n}\n\n/**\n * Returns the allowed identifiers (email, username, phone) based on the connection settings.\n */\nexport function getAllowedIdentifiers(transaction: TransactionContext): TransactionMembersOnLoginId['allowedIdentifiers'] {\n  const connection = transaction?.connection as DBConnection;\n  if (!connection?.options?.attributes) return null;\n\n  return extractIdentifiersByStatus(connection, ['required', 'optional']);\n}\n\n/**\n * Returns the required identifiers for signup (email, username, phone).\n */\nexport function getRequiredIdentifiers(transaction: TransactionContext): TransactionMembersOnSignupId['requiredIdentifiers'] {\n  return extractIdentifiersByStatus(transaction?.connection as DBConnection, ['required']);\n}\n\n/**\n * Returns the optional identifiers for signup (email, username, phone).\n */\nexport function getOptionalIdentifiers(transaction: TransactionContext): TransactionMembersOnSignupId['optionalIdentifiers'] {\n  return extractIdentifiersByStatus(transaction?.connection as DBConnection, ['optional']);\n}\n\nexport function hasFlexibleIdentifier(transaction: TransactionContext): boolean {\n  const connection = transaction.connection as DBConnection;\n  return connection?.options?.attributes ? true : false;\n}\n\n/**\n * Extracts identifiers based on their signup status.\n */\nfunction extractIdentifiersByStatus(\n  connection: DBConnection | undefined,\n  statuses: ('required' | 'optional')[],\n): ('email' | 'username' | 'phone')[] | null {\n  if (!connection?.options?.attributes) return null;\n\n  return Object.entries(connection.options.attributes)\n    .filter(([, value]) => value.signup_status && statuses.includes(value.signup_status as 'required' | 'optional'))\n    .map(([key]) => key as 'email' | 'username' | 'phone').length > 0\n    ? Object.entries(connection.options.attributes)\n        .filter(([, value]) => value.signup_status && statuses.includes(value.signup_status as 'required' | 'optional'))\n        .map(([key]) => key as 'email' | 'username' | 'phone')\n    : null;\n}\n"],"names":["isSignupEnabled","transaction","connection","options","signup_enabled","isForgotPasswordEnabled","forgot_password_enabled","isPasskeyEnabled","authentication_methods","passkey","enabled","isUsernameRequired","username_required","getUsernamePolicy","validation","attributes","username","maxLength","max_length","minLength","min_length","allowedFormats","usernameInEmailFormat","allowed_types","email","usernameInPhoneFormat","phone_number","getPasswordPolicy","passwordPolicy","password","policy","passwordSecurityInfo","password_security_info","getAllowedIdentifiers","extractIdentifiersByStatus","getRequiredIdentifiers","getOptionalIdentifiers","hasFlexibleIdentifier","statuses","Object","entries","filter","value","signup_status","includes","map","key","length"],"mappings":"AAOM,SAAUA,EAAgBC,GAC9B,OAA4D,IAArDA,GAAaC,YAAYC,SAASC,cAC3C,CAKM,SAAUC,EAAwBJ,GACtC,MAAMC,EAAaD,GAAaC,WAChC,OAAwD,IAAjDA,GAAYC,SAASG,uBAC9B,CAKM,SAAUC,EAAiBN,GAC/B,MAAMC,EAAaD,GAAaC,WAChC,OAAOA,GAAYC,SAASK,wBAAwBC,SAASC,UAAW,CAC1E,CAKM,SAAUC,EAAmBV,GACjC,MAAMC,EAAaD,GAAaC,WAChC,OAAOA,GAAYC,SAASS,oBAAqB,CACnD,CAKM,SAAUC,EAAkBZ,GAChC,MAAMC,EAAaD,GAAaC,WAC1BY,EAAaZ,GAAYC,SAASY,YAAYC,UAAUF,WAE9D,OAAKA,EAEE,CACLG,UAAWH,EAAWI,WACtBC,UAAWL,EAAWM,WACtBC,eAAgB,CACdC,sBAAuBR,EAAWS,eAAeC,QAAS,EAC1DC,sBAAuBX,EAAWS,eAAeG,eAAgB,IAP7C,IAU1B,CAKM,SAAUC,EAAkB1B,GAChC,MAAMC,EAAaD,GAAaC,WAC1B0B,EAAiB1B,GAAYC,SAASK,wBAAwBqB,SAEpE,OAAKD,EAEE,CACLT,UAAWS,EAAeR,WAC1BU,OAAQF,EAAeE,OACvBC,qBAAsBH,EAAeI,wBALX,IAO9B,CAKM,SAAUC,EAAsBhC,GACpC,MAAMC,EAAaD,GAAaC,WAChC,OAAKA,GAAYC,SAASY,WAEnBmB,EAA2BhC,EAAY,CAAC,WAAY,aAFd,IAG/C,CAKM,SAAUiC,EAAuBlC,GACrC,OAAOiC,EAA2BjC,GAAaC,WAA4B,CAAC,YAC9E,CAKM,SAAUkC,EAAuBnC,GACrC,OAAOiC,EAA2BjC,GAAaC,WAA4B,CAAC,YAC9E,CAEM,SAAUmC,EAAsBpC,GACpC,MAAMC,EAAaD,EAAYC,WAC/B,QAAOA,GAAYC,SAASY,UAC9B,CAKA,SAASmB,EACPhC,EACAoC,GAEA,OAAKpC,GAAYC,SAASY,YAEnBwB,OAAOC,QAAQtC,EAAWC,QAAQY,YACtC0B,QAAO,GAAIC,KAAWA,EAAMC,eAAiBL,EAASM,SAASF,EAAMC,iBACrEE,KAAI,EAAEC,KAASA,IAAuCC,OAAS,EAC9DR,OAAOC,QAAQtC,EAAWC,QAAQY,YAC/B0B,QAAO,GAAIC,KAAWA,EAAMC,eAAiBL,EAASM,SAASF,EAAMC,iBACrEE,KAAI,EAAEC,KAASA,IAPuB,IAS/C"}